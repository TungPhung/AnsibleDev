---
# playbook.yml - Deploy SSH config and keys to remote hosts
- name: Deploy SSH Configuration and Keys
  hosts: all
  become: yes
  vars:
    ssh_user: "{{ ansible_user }}"
    local_ssh_config: "files/ssh_config"
    local_private_key: "files/id_rsa"
    local_public_key: "files/id_rsa.pub"
    authorized_keys_file: "files/authorized_keys"
  
  tasks:
    - name: Ensure .ssh directory exists
      file:
        path: "/home/{{ ssh_user }}/.ssh"
        state: directory
        owner: "{{ ssh_user }}"
        group: "{{ ssh_user }}"
        mode: '0700'

    - name: Copy SSH config file
      copy:
        src: "{{ local_ssh_config }}"
        dest: "/home/{{ ssh_user }}/.ssh/config"
        owner: "{{ ssh_user }}"
        group: "{{ ssh_user }}"
        mode: '0600'
      when: local_ssh_config is exists

    - name: Copy SSH private key
      copy:
        src: "{{ local_private_key }}"
        dest: "/home/{{ ssh_user }}/.ssh/id_rsa"
        owner: "{{ ssh_user }}"
        group: "{{ ssh_user }}"
        mode: '0600'
      when: local_private_key is exists

    - name: Copy SSH public key
      copy:
        src: "{{ local_public_key }}"
        dest: "/home/{{ ssh_user }}/.ssh/id_rsa.pub"
        owner: "{{ ssh_user }}"
        group: "{{ ssh_user }}"
        mode: '0644'
      when: local_public_key is exists

    - name: Deploy authorized_keys
      copy:
        src: "{{ authorized_keys_file }}"
        dest: "/home/{{ ssh_user }}/.ssh/authorized_keys"
        owner: "{{ ssh_user }}"
        group: "{{ ssh_user }}"
        mode: '0600'
      when: authorized_keys_file is exists

    - name: Set correct SELinux context (if SELinux is enabled)
      command: restorecon -R /home/{{ ssh_user }}/.ssh
      when: ansible_selinux.status == "enabled"
      ignore_errors: yes

---
# inventory.ini - Example inventory file
[webservers]
web1.example.com ansible_user=ubuntu
web2.example.com ansible_user=ubuntu

[databases]
db1.example.com ansible_user=centos
db2.example.com ansible_user=centos

[all:vars]
ansible_python_interpreter=/usr/bin/python3
